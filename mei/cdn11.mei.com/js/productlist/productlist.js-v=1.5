var productSizes="";var brandNames="";var productTypes="";var productSizesForLoad="";var brandNamesForLoad="";var productTypesForLoad="";var priceOrderType="";var discountOrderType="";var currentTop=0;var currentPage=0;var totalPage=0;var contextPath="";var secondCategoryId="";var siloId="";var silo_name_en="";var timerLoadMore=null;var index=0;var addProductOp=null;if(!window.Enterprise){window.Enterprise={}}var brandLabel=$("#selectBrandDiv").find("> .selectlist_top > span").text(),typeLabel=$("#selectTypeDiv").find("> .selectlist_top > span").text();$(function(){currentTop=$("#searchContentDiv").offset().top-$("#navBarId").height();currentPage=$("#currentPage").val();totalPage=$("#totalPage").val();secondCategoryId=$("#secondCategoryId").val();contextPath=$("#contextPath").val();siloId=$("#siloId").val();silo_name_en=$("#silo_name_en").val();var i=$("#ui-page-num"),f=$("#ui-page-s");$(window).scroll(function(){var k=$(window).scrollTop();if(k>=currentTop){if(!$("#searchContentDiv").hasClass("productquery_top")){$("#searchContentDiv").addClass("productquery_top")}}else{if($("#searchContentDiv").hasClass("productquery_top")){$("#searchContentDiv").removeClass("productquery_top")}}});a();function a(){if(totalPage<2){return}var l=i.add(f),n=i.siblings(".ui-page-skip").find("> .form-page-skip"),m=Number(currentPage),k=$("#startDate").val(),k=k?k:"";l.on("click","> a",function(o){o.preventDefault();c($(this).attr("data-page"))});n.submit(function(p){p.preventDefault();var q=$(this).find("> .ui-page-skipTo"),o=q.val(),o=o.trim(),o=Number(o);if(isNaN(o)||!o){q.val(currentPage)}else{o=(o<1)?1:o;o=(o>totalPage)?totalPage:o;c(o)}})}function c(l){var k=$("#contentDiv").offset().top;k>300?$("html, body").animate({scrollTop:k-100}):$("html, body").animate({scrollTop:k-80});$pagerLoading=$("<div />").addClass("pager-loading").css({width:"100%",position:"absolute",top:0,left:0,right:0,padding:"0 0 15px","text-align":"center","background-color":"#fff","background-color":"rgba(255,255,255,0.75)","z-index":2,color:"#666"}).html('<img src="../../images/pager_loading.gif"/*tpa=http://cdn11.mei.com/images/pager_loading.gif*/> 正在加载中...');$("#contentDiv").prepend($pagerLoading);$.ajax({type:"get",url:contextPath+"/silo/loadMoreProductList.html",dataType:"json",data:{currentPage:--l,secondCategoryId:secondCategoryId,siloId:siloId,priceOrderType:priceOrderType,brandNames:brandNames,productTypes:productTypes,productSizes:productSizes,silo_name_en:silo_name_en,discountOrderType:discountOrderType},error:function(){k>300?$("html, body").animate({scrollTop:k-120}):$("html, body").animate({scrollTop:k-70});$($pagerLoading).remove();i.add(f).siblings(".ui-page-error").stop(true,true).show().delay(2000).fadeOut("slow")},success:function(m){if(m.currentPage){$("#contentDiv").html(m.result);currentPage=m.currentPage}Enterprise.insideOut.updatePagers()}})}Enterprise.insideOut={updatePagers:function(u){var l=i.next().clone(),m=$("<div />"),n,p,o=2,t=totalPage,k=currentPage-2,s=currentPage+2,r=nextMore=false;if(k>o){r=((k-1)==o)||((k-2)==o);r=!r}if(s<t){nextMore=((s+1)==t)||((s+2)==t);nextMore=!nextMore}if(r){startPage=k}else{startPage=1}if(nextMore){endPage=s}else{endPage=totalPage}if(startPage<1){startPage=1}if(endPage>totalPage){endPage=totalPage}if(currentPage==1){n=l.children(":eq(0)").clone()}else{n=l.children(":eq(1)").clone(),prevPage=currentPage-1,n=g(n,prevPage)}m.append(n);if(r){for(var q=1;q<3;q++){n=l.children(":eq(3)").clone();n=g(n,q,true);m.append(n)}n=l.children(":eq(6)").clone();m.append(n)}for(var q=startPage;q<=endPage;q++){if(q==currentPage){n=l.children(":eq(2)").clone().html(q)}else{n=l.children(":eq(3)").clone();n=g(n,q,true)}m.append(n)}if(nextMore){n=l.children(":eq(6)").clone();m.append(n);n=l.children(":eq(3)").clone();n=g(n,totalPage,true);m.append(n)}if(currentPage==totalPage){n=l.children(":eq(4)").clone()}else{n=l.children(":eq(5)").clone(),nextPage=currentPage+1;n=g(n,nextPage)}m.append(n);i.empty().append(m.children());l=f.next().clone(),m=$("<div />");n=l.children(":eq(0)").clone().html(currentPage+"/"+totalPage);m.append(n);if(currentPage==1){n=l.children(":eq(1)").clone()}else{n=l.children(":eq(2)").clone(),prevPage=currentPage-1;n=g(n,prevPage)}m.append(n);if(currentPage==totalPage){n=l.children(":eq(3)").clone()}else{n=l.children(":eq(4)").clone(),nextPage=currentPage+1;n=g(n,nextPage)}m.append(n);f.empty().append(m.children());if(u){f.parent().siblings("#ui-page-totalCount").find("> b").html(u)}i.siblings(".ui-page-skip").find(".ui-page-skipTo").val(currentPage).attr("data-page",currentPage).siblings("b").html(totalPage)},toggleShowMoreBtn:function(){var n=$("#nav-attrs").find("> .filter-list");if(!n.length){return}var m=n.find(".select_ul"),l=m.css("line-height").replace("px",""),k=l*2;m.each(function(p,q){var q=$(this),o=q.parent().next();(q.height()>k)?o.show():o.hide()})}};function g(l,m,k){l.attr("data-page",m);if(k){l.html(m)}return l}$("#selected-attrs").on("click","li",function(){var n=$(this),m=n.attr("data-type"),o=n.attr("data"),l,k;n.hide();if(m=="brand"){l=h(brandNames,o);brandNames=l;k="selectBrandLoading"}if(m=="type"){l=h(productTypes,o);productTypes=l;k="selectTypeLoading"}searchProduct(k,"menu");searchProduct(k,"page")}).on("click","> .reset-filters",function(){brandNames=productTypes="";searchProduct("noneLoading","menu");searchProduct("noneLoading","page")});$("#searchContentDiv").on("click",".sorter > a",function(){var l=$(this),p=l.hasClass("btn-reset-sorter");if(p){l.addClass("is-default").siblings(".order-by").removeClass("asc desc");priceOrderType=discountOrderType=""}else{var r=l.hasClass("desc"),k=l.hasClass("asc"),m=!r&&!k,q=l.siblings(".btn-reset-sorter"),s=q.hasClass("is-default"),o=l.hasClass("by-price"),n;if(m){l.addClass("asc");n="ASC"}else{if(r){l.addClass("asc").removeClass("desc");n="ASC"}else{l.addClass("desc").removeClass("asc");n="DESC"}}if(o){priceOrderType=n}else{discountOrderType=n}if(s){q.removeClass("is-default")}}searchProduct("sorter-loader","page")});j();function j(){var k=$("#nav-attrs").find("> .filter-list");if(!k.length){return}Enterprise.insideOut.toggleShowMoreBtn();k.on("click",".show-more",function(n,o){var o=$(this),l=!o.hasClass("expanded"),m=l?o.attr("data-fold"):o.attr("data-more");o.toggleClass("expanded").html(m).prev().toggleClass("expanded-list")})}function h(k,l){if(k==l){k=""}else{var m=k.split(","),n=$.inArray(l,m);m.splice(n,1);k=m.join(",")}return k}var b=$("#scrollTypeDiv .select_ul li").length;var e=null;var d=e+1;$("#scrollTypeDiv .select_ul li").live("click",function(){e=$(this).index();d=e+1<b?e+1:0;if($("#scrollTypeDiv .select_ul li span").eq(e).hasClass("selected")){$("#scrollTypeDiv .select_ul li span").eq(e).removeClass("selected");$("#scrollTypeDiv .select_ul li span").eq(e).addClass("not_selected")}else{$("#scrollTypeDiv .select_ul li span").eq(e).removeClass("not_selected");$("#scrollTypeDiv .select_ul li span").eq(e).addClass("selected")}var l=$("#scrollTypeDiv .select_ul li span");productTypes="";for(var k=0;k<l.length;k++){if($("#scrollTypeDiv .select_ul li span").eq(k).hasClass("selected")){if(productTypes==""){productTypes+=$("#scrollTypeDiv .select_ul li").eq(k).attr("data")}else{productTypes+=","+$("#scrollTypeDiv .select_ul li").eq(k).attr("data")}}}if(productTypes==""){$("#btn_resetType").hide()}else{$("#btn_resetType").show()}searchProduct("selectTypeLoading","menu");searchProduct("selectTypeLoading","page")});b=$("#scrollDiv .select_ul li").length;e=null;d=e+1;$("#scrollDiv .select_ul li").live("click",function(){e=$(this).index();d=e+1<b?e+1:0;if($("#scrollDiv .select_ul li span").eq(e).hasClass("selected")){$("#scrollDiv .select_ul li span").eq(e).removeClass("selected");$("#scrollDiv .select_ul li span").eq(e).addClass("not_selected")}else{$("#scrollDiv .select_ul li span").eq(e).removeClass("not_selected");$("#scrollDiv .select_ul li span").eq(e).addClass("selected")}var l=$("#scrollDiv .select_ul li span");brandNames="";for(var k=0;k<l.length;k++){if($("#scrollDiv .select_ul li span").eq(k).hasClass("selected")){if(brandNames==""){brandNames+=$("#scrollDiv .select_ul li").eq(k).attr("data")}else{brandNames+=","+$("#scrollDiv .select_ul li").eq(k).attr("data")}}}if(brandNames==""){$("#btn_resetBrand").hide()}else{$("#btn_resetBrand").show()}searchProduct("selectBrandLoading","menu");searchProduct("selectBrandLoading","page")});$("#listproduct").live("mouseenter",function(){if(!$("#product_select_info").is(":animated")&&!$("#img_002").is(":animated")){$("#product_select_info").animate({left:0+"px"},"10");$("#img_002").animate({left:0+"px"},"10")}});$("#listproduct").live("mouseleave",function(){if(!$("#product_select_info").is(":animated")&&!$("#img_002").is(":animated")){$("#product_select_info").animate({left:-320+"px"},"10");$("#img_002").animate({left:320+"px"},"10")}})});function loadScroll(c){var b=$("#"+c).height();var a=$("#"+c+" .select_ul").eq(0).height();if(null==a||typeof(a)=="undefined"){var a=$("#"+c+" #innerScrollSizeDiv").height()}if(null!=b&&typeof(b)!="undefined"&&a>b){$("#"+c).jscroll({W:"3px",BgUrl:"",Bg:"right #e7e7e7 repeat-x",Bar:{Pos:"up",Bd:{Out:"#000 background-color #000",Hover:"#000 "},Bg:{Out:"-45px 0 repeat-x #000",Hover:"-58px 0 repeat-x  #000 pointer",Focus:"-71px 0 repeat-x  #000"}},Btn:{btn:false,uBg:{Out:"0 0 ",Hover:"-15px 0",Focus:"-30px 0"},dBg:{Out:"0 -15px",Hover:"-15px -15px",Focus:"-30px -15px"}},Fn:function(){}})}}function mouseOverImage(a){if($("#product_pop_info"+a).is(":hidden")){$("#product_pop_info"+a).show()}}function mouseOutImage(a){$("#product_pop_info"+a).hide()}function selectSizeClick(h){if($(h).hasClass("product_size_Checked")){$(h).removeClass("product_size_Checked")}else{$(h).addClass("product_size_Checked")}var e=$("#scrollSizeDiv .product_size");productSizes="";var a="";var c=false;for(var b=0;b<e.length;b++){a="";if($("#sizeGroup"+b).attr("data")=="ALL"){if(productSizes==""){a+="ALL"}else{a+="_ALL"}}else{if(productSizes==""){a+=$("#sizeGroup"+b).attr("data")+":"}else{a+="_"+$("#sizeGroup"+b).attr("data")+":"}}c=false;var f=$("#sizeGroup"+b+" ul li span");for(var d=0;d<f.length;d++){if($("#sizeGroup"+b+" ul li span").eq(d).hasClass("product_size_Checked")){var g=$("#sizeGroup"+b+" ul li").eq(d).attr("data");if(!c){productSizes+=a;c=true}if(g=="ALL"){}else{if(productSizes.substr(productSizes.length-1)==":"){productSizes+=g}else{productSizes+=","+g}}}}}if(productSizes==""){$("#btn_resetSize").hide()}else{$("#btn_resetSize").show()}searchProduct("selectSizeLoading","menu")}function doSearchAll(){$("#btnSearchAll").hide();$("#btnSearchLoading").show();productSizesForLoad=productSizes;brandNamesForLoad=brandNames;productTypesForLoad=productTypes;searchProduct("noneLoading","page")}function showOrHideBtnSearchAll(){if(brandNames!=""||productTypes!=""||productSizes!=""){$("#btnSearchAll").show()}else{$("#btnSearchAll").hide()}}function searchProduct(c,b){var a=$("#"+c);if(null!=a&&typeof(a)!="undefined"){a.show()}$.ajax({type:"get",url:contextPath+"/silo/searchProductList.html",dataType:"json",data:{priceOrderType:priceOrderType,secondCategoryId:secondCategoryId,siloId:siloId,brandNames:brandNames,productTypes:productTypes,productSizes:productSizes,silo_name_en:silo_name_en,discountOrderType:discountOrderType,searchType:b},success:function(h){var f=h.result;var e=h.brandList;$("#scrollDiv").html(e);if(h.brandNames!=null){brandNames=h.brandNames}var g=h.categoryList;$("#scrollTypeDiv").html(g);if(h.productTypes!=null){productTypes=h.productTypes}var d=h.sizeList;$("#scrollSizeDiv").html(d);if(h.productSizes!=null){productSizes=h.productSizes}if(e||g){paintSelectedFilters(e,g)}Enterprise.insideOut.toggleShowMoreBtn();switch(f){case 0:break;default:$("#contentDiv").html(f);$("#contentDiv").css("padding-bottom","100px");currentPage=1;totalPage=h.totalPage;Enterprise.insideOut.updatePagers(h.totalCount);break}a.hide()}});isLastPage=false}function paintSelectedFilters(c,d){var a=_paintSelectedFilters(c,"brand",brandLabel),f=_paintSelectedFilters(d,"type",typeLabel),e=$("<div />"),b,g=$("#selected-attrs").find("> .attrs");if(a&&a.children().length){e.append(a.children())}if(f&&f.children().length){e.append(f.children())}b=e.children();if(b.length){g.empty().append(b).parent().show()}else{g.empty().parent().hide()}}function _paintSelectedFilters(f,d,a){var c="",e=$("<ul />"),b;if(f){c=e;$(f).find("span").each(function(){var h=$(this),g=h.hasClass("selected");if(g){b=h.text(a).parent().attr("data-type",d);c.append(b)}})}return c}function productSizeClick(f,d,a){var e=$("#product_select_info"+d+" .product_size ul li span");var b=0;for(var c=0;c<e.length;c++){if($("#product_select_info"+d+" .product_size ul li span").eq(c).hasClass("product_size_Checked")){$("#product_select_info"+d+" .product_size ul li span").eq(c).removeClass("product_size_Checked")}if(e[c]==f){b=c}}if($(f).hasClass("product_size_Checked")){$(f).removeClass("product_size_Checked")}else{$(f).addClass("product_size_Checked")}e=$("#dhtzUl"+d+" li span");for(var c=0;c<e.length;c++){if($("#dhtzUl"+d+" li span").eq(c).hasClass("product_size_Checked")){$("#dhtzUl"+d+" li span").eq(c).removeClass("product_size_Checked")}}if($("#dhtzUl"+d+" li span").eq(b).hasClass("product_size_Checked")){$("#dhtzUl"+d+" li span").eq(b).removeClass("product_size_Checked")}else{$("#dhtzUl"+d+" li span").eq(b).addClass("product_size_Checked")}$("#sizeId"+d).val(a);$("#message"+d).html("");$("#message"+d).hide()}function productSizeForDhtzClick(e,a,d){getQRCode(a,d);var c=$("#dhtzPopUl li span");for(var b=0;b<c.length;b++){if($("#dhtzPopUl li span").eq(b).hasClass("product_size_Checked")){$("#dhtzPopUl li span").eq(b).removeClass("product_size_Checked")}}if($(e).hasClass("product_size_Checked")){$(e).removeClass("product_size_Checked")}else{$(e).addClass("product_size_Checked")}$("#dhtzSizeId1").val(a)}function addEventProduct(g,e,d,c){$(g).html("提交中...");addProductOp=g;var b=$("#sizeId"+e).val();if(b==""){$("#message"+e).html("请选择适合您的尺寸！");$("#message"+e).show()}else{var f=isLogins();if(f==="nologin"){showdiv("poplogin")}else{var a=addProduct(b,d,"",c);if(a!=null){if(a.msg!=""){showMessage(e,a.msg);setTimeout("hiddenMessage('"+e+"')",3000)}}}}setTimeout("recoverMessage()",200)}function showMessage(a,b){if($("#product_select_info"+a+" #productSizeDiv").is(":hidden")){$("#product_select_info"+a+" #productSizeDiv").show()}$("#message"+a).html(b);$("#message"+a).show()}function hiddenMessage(a){$("#message"+a).html("");$("#message"+a).hide();if($("#product_select_info"+a+" #productSizeDiv").attr("name")=="none"){$("#product_select_info"+a+" #productSizeDiv").hide()}}function recoverMessage(a){$(addProductOp).html("加入购物袋")}function showDhtzPoPDiv(a,c,b){var e=isLogins();if(e==="nologin"){showdiv("poplogin")}else{$("#dhtzPopUl").html($("#dhtzUl"+c).html());if($("#dhtzPopUl li").text()==""){$("#arrivalNoticeProductSize").hide()}else{$("#arrivalNoticeProductSize").show()}$("#dhtzEventId").val(b);showdiv(a);var d=$("#dhtzSizeId"+c).val();if(null!=d&&typeof(d)!="undefined"){$("#dhtzSizeId1").val(d);toGetArrivalInfo();getQRCode(d,b)}}}function showBankDhtzPoPDiv(a,c,b){if($("#membereid").val()==""){showdiv("loginBank")}else{$("#dhtzPopUl").html($("#dhtzUl"+c).html());if($("#dhtzPopUl li").text()==""){$("#arrivalNoticeProductSize").hide()}else{$("#arrivalNoticeProductSize").show()}$("#dhtzEventId").val(b);showdiv(a);var d=$("#dhtzSizeId"+c).val();if(null!=d&&typeof(d)!="undefined"){$("#dhtzSizeId1").val(d);toGetArrivalInfo();getQRCode(d,b)}}}function toGetArrivalInfo(){$.ajax({type:"get",url:contextPath+"/silo/toGetArrival.html",success:function(b){var a=b.result;if(a!=null&&a!=""){$("#showDivDialog #txtNoticeContent1").val(a);$("#showDivDialog #txtNoticeContent1").css("color","black")}}})}function getQRCode(a,b){$.ajax({type:"get",url:contextPath+"/silo/getQRCode.html",dataType:"json",data:{productId:a,evEventId:b},success:function(e){var c=e.result;if(c=="suc"){var d=e.qrCode;$("#showDivDialog #imgQrCode").attr("src","https://mp.weixin.qq.com/cgi-bin/showqrcode?ticket="+d)}else{$("#showDivDialog #noticeMsg").html("获取微信图片失败")}}})}function showPoPDiv(a){if(a=="aNSuccess"){if($("#dhtzSizeId1").val()==""){$("#showDivDialog #noticeMsg").html("请选择一个尺寸");return}}var f=$("#dhtzSizeId1").val();var e=$("#dhtzEventId").val();var c=$("#showDivDialog #txtNoticeContent1").val();var d="1";var b=/^([a-zA-Z0-9]+[_|\_|\.-]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.-]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;var g=/^[0-9]{11}$/;if(null==c||""==c||null==$.trim(c)||""==$.trim(c)||"请输入您的手机号码或邮箱"==$.trim(c)){$("#showDivDialog #noticeMsg").html("请输入您的手机号码或邮箱");return}else{if(b.test(c)||g.test(c)){if(b.test(c)){if("http://cdn11.mei.com/js/productlist/@yahoo.com.cn"==c||"http://cdn11.mei.com/js/productlist/@yahoo.cn"==c){$("#showDivDialog #noticeMsg").html("Yahoo 中国邮箱已停止使用，请您更换其它邮箱");return}d="1"}else{d="2"}}else{$("#showDivDialog #noticeMsg").html("请输入正确的手机号码或邮箱");return}}$.ajax({type:"get",url:contextPath+"/silo/arrivalNotice.html",dataType:"json",data:{noticeContent:c,productId:f,eventId:e,type:d},success:function(i){var h=i.result;if(h=="suc"){showdiv(a)}else{$("#showDivDialog #noticeMsg").html("到货通知提交失败")}}})}function clearText(a){if($(a).val()=="请输入您的手机号码或邮箱"){$(a).val("");$(a).css("color","black")}}function changeImageList(b,a,c){if(null!=a&&typeof(a)!="undefined"){$("#productImg"+b).attr("src",a)}$("#smallImgDiv"+b).children("span").removeClass("border_color2_Checked");$(c).addClass("border_color2_Checked")}function showRecommendInfo(b){var a=$(b).prev();if(null!=a&&typeof(a)!="undefined"){a.children("div").show()}}function hideRecommendInfo(b){var a=$(b).prev();if(null!=a&&typeof(a)!="undefined"){a.children("div").hide()}}function changeDisplay(b,a){if($(b).hasClass("icon_arrow_down_a")){$(b).removeClass("icon_arrow_down_a");$(b).addClass("icon_arrow_right_a");$(b).css("top","3px");$(b).css("left","3px");$("#"+a).slideUp("fast")}else{$(b).removeClass("icon_arrow_right_a");$(b).addClass("icon_arrow_down_a");$(b).css("top","5px");$(b).css("left","0px");$("#"+a).slideDown("fast")}};